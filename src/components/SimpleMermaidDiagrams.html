<!doctype html>
<html lang="en">
  <body>
    <pre class="mermaid">
  flowchart TD
  A[Пассажир A запрашивает водное такси] --> B[Система строит маршрут R_A и рассчитывает индивидуальный тариф]
  B --> C[Поиск потенциальных попутчиков с похожими маршрутами]
  C --> D{Соответствуют ли кандидаты ограничениям по времени и объезду?}
  D -- Yes --> E[Рассчитать дополнительное время, расстояние и балл совпадения]
  D -- No --> F[Пропустить кандидата]
  E --> G[Отправить предложение поездки с ETA и предполагаемой платой]
  G --> H{Принимает ли кандидат?}
  H -- Yes --> I[Заблокировать место и оптимизировать объединенный маршрут]
  H -- No --> J[Продолжить поиск или ехать в одиночку]
  I --> K[Пересчитать общую стоимость и разделить тарифы]
  K --> L[Уведомить всех пассажиров об окончательном ETA и цене]
  L --> M{Появляется новый запрос пассажира?}
  M -- Yes --> N[Проверить влияние объезда на всех пассажиров]
  N --> O{Объезд в пределах разрешенных ограничений?}
  O -- Yes --> P[Добавить пассажира, пересчитать маршрут и тариф]
  O -- No --> Q[Отклонить или запросить согласие пассажира]
  Q --> R[Если согласие дано → Добавить пассажира, иначе отклонить]
  M -- No --> S[Продолжить поездку]
    </pre>
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
    </script>
  </body>
</html>